<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Payment Page</title>
  <style>
    :root{
      --accent: orangered;
      --bg: #ffffff;
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }

    body{
      margin:0;
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      background: radial-gradient(circle at 10% 10%, rgba(255,69,0,0.06), transparent 10%),
                  radial-gradient(circle at 90% 90%, rgba(0,0,0,0.04), transparent 10%),
                  var(--bg);
    }

    .payment-wrapper{
      width:920px;
      max-width:95vw;
      display:grid;
      grid-template-columns: 1fr 420px;
      gap:28px;
      align-items:center;
    }

    .card-visual{
      height:260px;
      border-radius:18px;
      padding:22px;
      color:white;
      background: linear-gradient(135deg,#0f172a 0%, #0b1220 55%), url('https://img.freepik.com/free-vector/abstract-credit-card-template_23-2149124814.jpg') center/cover no-repeat;
      position:relative;
      box-shadow: 0 10px 30px rgba(2,6,23,0.6);
      overflow:hidden;
    }

    .chip{
      width:52px;height:40px;border-radius:6px;background:linear-gradient(180deg,#ffd89b,#c07a00);
    }
    .card-top{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .card-brand{font-weight:700;letter-spacing:1px}
    .card-number{margin-top:22px;font-size:20px;letter-spacing:3px;font-weight:600}
    .card-meta{display:flex;justify-content:space-between;margin-top:26px}
    .card-holder{font-size:13px;text-transform:uppercase}
    .card-exp{font-size:13px}

    .payment-form{
      background: white;
      border-radius:12px;
      padding:22px;
      box-shadow: 0 6px 20px rgba(16,24,40,0.08);
      border:1px solid rgba(0,0,0,0.04);
    }

    .payment-form h2{margin:0 0 12px 0;color:#0f172a}
    .field{display:flex; flex-direction: column; margin-bottom:12px;}
    label{font-size:13px;color:#0f172a;margin-bottom:6px; display: flex; flex-direction: column;}
    input, select{padding:12px 14px;border-radius:8px;border:1px solid rgba(15,23,42,0.06);font-size:15px;outline:none}
    input:focus{box-shadow:0 0 0 4px rgba(255,69,0,0.06);border-color:var(--accent)}

    .row{display:flex;gap:10px  }
    .row .field{flex:1}

    button.pay{
      width:100%;padding:12px 16px;border-radius:10px;border:none;background:var(--accent);color:white;font-weight:700;font-size:16px;cursor:pointer;box-shadow:0 8px 20px rgba(255,69,0,0.18)
    }

    .loader-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(11,11,15,0.45);backdrop-filter: blur(3px);}
    .loader-box{background:white;padding:18px;border-radius:10px;display:flex;flex-direction:column;align-items:center;gap:12px;min-width:220px}
    .spinner{width:36px;height:36px;border-radius:50%;border:4px solid rgba(0,0,0,0.08);border-top-color:var(--accent);animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}



.row .field {
  flex: 0 0 32%;
}
.row .field .cvv{
width: 86px;
}
  </style>
</head>
<body>
  <div class="payment-wrapper">
    <div class="card-visual">
      <div class="card-top">
        <div class="chip"></div>
        <div class="card-brand">PayFlow</div>
      </div>
      <div class="card-number" id="cardPreview">•••• •••• •••• ••••</div>
      <div class="card-meta">
        <div>
          <div>Card holder</div>
          <div class="card-holder" id="holderPreview">FULL NAME</div>
        </div>
        <div>
          <div>Expires</div>
          <div class="card-exp" id="expPreview">MM / YY</div>
        </div>
      </div>
    </div>

    <form class="payment-form" id="paymentForm">
      <h2>Payment Details</h2>
      <div class="field">
        <label for="cardHolder">Card holder name</label>
        <input id="cardHolder" type="text" placeholder="Full name" required>
      </div>

      <div class="field">
        <label for="cardNumber">Card number</label>
        <input id="cardNumber" type="text" placeholder="1234 5678 9012 3456" maxlength="19" required>
      </div>

      <div class="row">
        <div class="field">
          <label for="expMonth" >Expiry month</label>
          <select id="expMonth" required>
            <option value="">MM</option>
            <script>for(let i=1;i<=12;i++){document.write(`<option value='${i}'>${i}</option>`)}</script>
          </select>
        </div>
        <div class="field">
          <label for="expYear">Expiry year</label>
          <select id="expYear" required>
            <option value="">YYYY</option>
            <script>const y=new Date().getFullYear();for(let i=0;i<10;i++){document.write(`<option value='${y+i}'>${y+i}</option>`)}</script>
          </select>
        </div>
        <div class="field">
          <label for="cvv">CVV</label>
          <input id="cvv" class="cvv" type="password" placeholder="123" maxlength="4" required>
        </div>
      </div>
      <button class="pay" type="submit">Pay Now</button>
    </form>
  </div>

  <div class="loader-overlay" id="loader">
    <div class="loader-box">
      <div class="spinner"></div>
      <p>Processing Payment...</p>
    </div>
  </div>

  <script>
    const cardNumberInput = document.getElementById('cardNumber');
    const cardHolderInput = document.getElementById('cardHolder');
    const expMonth = document.getElementById('expMonth');
    const expYear = document.getElementById('expYear');

    const cardPreview = document.getElementById('cardPreview');
    const holderPreview = document.getElementById('holderPreview');
    const expPreview = document.getElementById('expPreview');

    cardNumberInput.addEventListener('input', e => {
      let v = e.target.value.replace(/\D/g,'').slice(0,19);
      v = v.replace(/(.{4})/g,'$1 ').trim();
      e.target.value = v;
      cardPreview.textContent = v ? v : '•••• •••• •••• ••••';
    });

    cardHolderInput.addEventListener('input', e => {
      holderPreview.textContent = e.target.value ? e.target.value.toUpperCase() : 'FULL NAME';
    });

    function updateExp(){
      const m = expMonth.value || 'MM';
      const y = expYear.value ? String(expYear.value).slice(-2) : 'YY';
      expPreview.textContent = m + ' / ' + y;
    }

    expMonth.addEventListener('change', updateExp);
    expYear.addEventListener('change', updateExp);

    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('paymentForm');
      const loader = document.getElementById('loader');

      form.addEventListener('submit', function(e) {
        e.preventDefault();
        loader.style.display = 'flex';
        setTimeout(() => {
          window.location.href = 'confirmation.html';
        }, 2000);
      });
    });
    document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('paymentForm');
  const loader = document.getElementById('loader');

  form.addEventListener('submit', async function(e) {
    e.preventDefault();
    loader.style.display = 'flex';

    const bookingData = JSON.parse(localStorage.getItem("pendingBooking"));
    if (!bookingData) {
      alert("No booking found. Please reserve a car first.");
      loader.style.display = 'none';
      window.location.href = 'booking.html';
      return;
    }

    try {
      // Simulate payment delay
      await new Promise(resolve => setTimeout(resolve, 2000));

      // Send booking to server
      const res = await fetch("http://localhost:3000/api/book", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(bookingData)
      });

      const data = await res.json();
      if (res.ok) {
        loader.style.display = 'none';
        localStorage.removeItem("pendingBooking");
        localStorage.setItem("bookingData", JSON.stringify(bookingData));
        alert("Payment successful! Booking confirmed.");
        window.location.href = "confirmation.html";
      } else {
        loader.style.display = 'none';
        alert("Error: " + data.error);
        window.location.href = 'booking.html';
      }
    } catch (err) {
      loader.style.display = 'none';
      console.error(err);
      alert("Payment failed. Try again.");
    }
  });
});

  </script>
</body>
</html>